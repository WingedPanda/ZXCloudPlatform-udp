<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>实时监测数据</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="description" content="Materialize is a Material Design Admin Template,It's modern, responsive and based on Material Design by Google. ">
    <meta name="keywords" content="materialize, admin template, dashboard template, flat admin template, responsive admin template,">

    <!-- CORE CSS-->
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="lib/socket.io.js"></script>
    <script type="text/javascript" src="js/Chart.js"></script>
    <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection">
        <link href="css/bootstrap.css" type="text/css" rel="stylesheet" media="screen,projection">
    <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection">
    <!-- CSS for full screen (Layout-2)-->
    <link href="css/layouts/style-fullscreen.css" type="text/css" rel="stylesheet" media="screen,projection">
    <!-- Custome CSS-->
    <link href="css/custom/custom.css" type="text/css" rel="stylesheet" media="screen,projection">
<link rel="stylesheet" href="css/realtime/monitor-jsd.css" media="screen" title="no title">

<link href="js/plugins/perfect-scrollbar/perfect-scrollbar.css" type="text/css" rel="stylesheet" media="screen,projection">
<link href="js/plugins/jvectormap/jquery-jvectormap.css" type="text/css" rel="stylesheet" media="screen,projection">
<link href="js/plugins/chartist-js/chartist.min.css" type="text/css" rel="stylesheet" media="screen,projection">
<link href="css/dashboard.css" type="text/css" rel="stylesheet" media="screen,projection">
  </head>
  <body style="background-color:#0a1a2d">


    <!-- //////////////////////////////////////////////////////////////////////////// -->

    <!-- START HEADER -->
    <header id="header" class="page-topbar">
        <!-- start header nav-->
        <!-- Start Page Loading -->
      <div id="loader-wrapper">
          <div id="loader"></div>
          <div class="loader-section section-left"></div>
          <div class="loader-section section-right"></div>
      </div>
      <!-- End Page Loading -->

      <!-- //////////////////////////////////////////////////////////////////////////// -->

      <!-- START HEADER -->
      <header id="header" class="page-topbar">
          <!-- start header nav-->
          <div class="navbar-fixed ">
              <nav class="navbar-color">
                  <div class="nav-wrapper center">
                    <ul >
                          <li class=""><h3 style="">&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp滁河大桥安全监测平台</h3></li>
                    </ul>

                  <!--    <ul class="left">
                        <li><h1 class="logo-wrapper"><a href="#" class="brand-logo darken-1"><img src="images/materialize-logo.png" alt="materialize logo"></a> <span class="logo-text">Materialize</span></h1></li>
                      </ul>-->

                      <ul class="right hide-on-med-and-down">
                          <li><a href="javascript:void(0);" class="waves-effect waves-block waves-light toggle-fullscreen"><i class="mdi-action-settings-overscan"></i></a>
                          </li>
                          <li><a href="javascript:void(0);" class="waves-effect waves-block waves-light notification-button" data-activates="notifications-dropdown"><i class="mdi-social-notifications"><small class="notification-badge">5</small></i>

                          </a>
                          </li>
                          <li><a href="#" data-activates="chat-out" class="waves-effect waves-block waves-light chat-collapse"><i class="mdi-communication-chat"></i></a>
                          </li>
                     </ul>

                      <!-- notifications-dropdown -->
                      <ul id="notifications-dropdown" class="dropdown-content">
                        <li>
                          <h5>告警 <span class="new badge">5</span></h5>
                        </li>
                        <li class="divider"></li>
                        <li>
                          <a href="#!"><i class="mdi-action-add-shopping-cart"></i> 上周告警数量</a>
                          <time class="media-meta">10次</time>
                        </li>
                        <li>
                          <a href="#!"><i class="mdi-action-stars"></i>上月告警数量</a>
                          <time class="media-meta">15次</time>
                        </li>
                      </ul>
                  </div>
              </nav>
          </div>
          <!-- end header nav-->
      </header>
      <!-- END HEADER -->

      <!-- //////////////////////////////////////////////////////////////////////////// -->

      <!-- START MAIN -->
      <div id="main">
          <!-- START WRAPPER -->
          <div class="wrapper">

              <!-- START LEFT SIDEBAR NAV-->
              <aside id="left-sidebar-nav" style="height:800px;">
                  <ul id="slide-out" class="side-nav leftside-navigation">
                      <li class="user-details cyan darken-2">
                          <div class="row">
                              <div class="col col s4 m4 l4">
                                  <img src="images/avatar.jpg" alt="" class="circle responsive-img valign profile-image">
                              </div>
                              <div class="col col s8 m8 l8">
                                  <ul id="profile-dropdown" class="dropdown-content">
                                      <li><a href="#"><i class="mdi-action-face-unlock"></i> 记录</a>
                                      </li>
                                      <li><a href="#"><i class="mdi-action-settings"></i> 设置</a>
                                      </li>
                                      <li><a href="#"><i class="mdi-communication-live-help"></i> 帮助</a>
                                      </li>
                                      <li class="divider"></li>
                                  <!--    <li><a href="#"><i class="mdi-action-lock-outline"></i> Lock</a>
                                  </li>  -->
                                      <li><a href="#"><i class="mdi-hardware-keyboard-tab"></i> 注销</a>
                                      </li>
                                  </ul>
                                  <a class="btn-flat dropdown-button waves-effect waves-light white-text profile-btn" href="#" data-activates="profile-dropdown">admin<i class="mdi-navigation-arrow-drop-down right"></i></a>
                                  <p class="user-roal">管理员</p>
                              </div>
                          </div>
                      </li>
                      <li class="bold"><a href="dashboard.html" class="waves-effect waves-cyan" style="background-color:#043348"><i class="mdi-action-dashboard"></i> 首页</a>
                  </li>



                 <li class="no-padding" font color="white"; >
                      <ul class="collapsible collapsible-accordion" style="background-color:#0a1a2d;color:#203656">

                        <li class="bold"><a class="collapsible-header  waves-effect waves-cyan "><i class="mdi-image-palette"></i> 网络拓扑图</a>

                        </li>
                          <li class="bold"><a class="collapsible-header waves-effect waves-cyan active"><i class="mdi-action-view-carousel"></i>实时监测</a>
                              <div class="collapsible-body" style="background-color:#0a1a2d;">
                                  <ul>
                                      <li ><a href="#">挠度</a>
                                      </li>
                                      <li><a href="#">位移</a>
                                      </li>
                                      <li><a href="#">垂直度</a>
                                      </li>
                                      <li><a href="#">应变</a>
                                      </li>
                                      <li><a href="#">索力</a>
                                      </li>
                                      <li><a href="#">振动</a>
                                      </li>
                                      <li><a href="#">温湿度</a>
                                      </li>
                                      <li><a href="#">腐蚀</a>
                                      </li>
                                      <li><a href="#">交通荷载</a>
                                      </li>
                                  </ul>
                              </div>
                          </li>


                           <li class="bold"><a class="collapsible-header waves-effect waves-cyan"><i class="mdi-editor-insert-invitation"></i> 分析数据</a>
                               <div class="collapsible-body" style="background-color:#0a1a2d">
                                   <ul>
                                       <li><a href="#">频谱分析</a>
                                       </li>
                                       <li><a href="#">线性相关性</a>
                                       </li>
                                       <li><a href="#">小波算法</a>
                                       </li>
                                       <li><a href="#">神经元算法</a>
                                       </li>
                                   </ul>
                               </div>
                           </li>
                       </ul>
                   </li>

                <!--  <li class="bold"><a href="app-email.html" class="waves-effect waves-cyan"><i class="mdi-communication-email"></i> Mailbox <span class="new badge">4</span></a>
                </li>
                  <li class="bold"><a href="app-calendar.html" class="waves-effect waves-cyan"><i class="mdi-editor-insert-invitation"></i> Calender</a>
                  </li>
                  <li class="li-hover"><p class="ultra-small margin more-text">MORE</p></li>-->

                  <li><a href="#"><i class="mdi-communication-live-help"></i> 告警<span class="new badge">5</span></a>
                  </li>

                  <li><a href="#"><i class="mdi-action-verified-user"></i> 报告报表</a>
                  </li>
                  <li><a href="#"><i class="mdi-action-swap-vert-circle"></i> 维修记录单</a>
                  </li>
                  <li class="li-hover"><div class="divider"></div></li>
                  <li class="li-hover"><p class="ultra-small margin more-text">每天登陆人数</p></li>
                    <li class="li-hover">
                      <div class="row">
                          <div class="col s12 m12 l12">
                              <div class="sample-chart-wrapper">
                                  <div class="ct-chart ct-golden-section" id="ct2-chart"></div>
                              </div>
                          </div>
                      </div>
                    </li>
                  </ul>
                  <a href="#" data-activates="slide-out" class="sidebar-collapse btn-floating btn-medium waves-effect waves-light cyan btn-sidenav"><i class="mdi-navigation-menu "></i></a>
              </aside>
              <!-- END LEFT SIDEBAR NAV-->

              <!-- //////////////////////////////////////////////////////////////////////////// -->


     <!-- //////////////////////////////////////////////////////////////////////////// -->
 <section id="content" class="white-text"  >
  <div class="container" >
    <p style="font-size:20px;margin:20px 10px;">振动加速度3 <img src="images/arrow-rignt.png" alt="" style="height:20px;" />
    </p>
    <div class="row" style="background-color:#1c334f; margin-bottom:20px;">
      <div class="col s2 " >
        <div class="col s2 center" style="margin:20px 10px 5px 10px;position:relative;background:url(images/flottime.png);background-size:237px 194px;height:194px;width:237px;">
                <div class="center" style="position:absolute;width:30px; height:30px; top: 80px; left: 50px;">
                  <span style="font-size:54px;color:#6aff7d">358.3</span>
                </div>
                <div class="center" style="position:absolute;width:30px; height:30px; top: 150px; left: 80px;">
                  <span style="font-size:24px;">mm/s²</span>
                </div>
                <div class="center" style="position:absolute;width:30px; height:30px; top: 190px; left: 10px;">
                  <span style="font-size:24px;color:#6aff7d">140.7</span>
                </div>
                <div class="center" style="position:absolute;width:30px; height:30px; top: 190px; left: 170px;">
                  <span style="font-size:24px;color:#ff5665">828.9</span>
                </div>
               <!-- <img src="images/flottime.png" alt="" style="height:200px;width:220px; margin-top:10px;"/> -->
              </div>
      </div>
      <div class="col s5" style="height:200px;margin:20px 0px;">
        <p style="font-size:30px;color:#b9e5ef; margin-left:35px;">
          今日截止当前（mm/s²）
        </p>
        <div class="box">
          <span class="statistic" style="height:120px;">
            <p class="num center">
              389.2
            </p>
            <p class="unit center">
              平均
            </p>
          </span>
          <span class="statistic" style="height:120px;">
            <p class="num center">
              140.7
            </p>
            <p class="unit center">
              最小值
            </p>
          </span>
          <span class="statistic" style="height:120px;">
            <p class="num center">
              828.9
            </p>
            <p class="unit center">
              最大值
            </p>
          </span>

        </div>
      </div>
      <div class="col s5 cut" style="height:200px;margin:20px 0px;">
        <p style="font-size:30px;color:#b9e5ef; margin-left:35px;">
          昨日（mm/s²）
        </p>
        <div class="box">
          <span class="statistic" style="height:120px;">
            <p class="num center">
              404.2
            </p>
            <p class="unit center">
              平均
            </p>
          </span>
          <span class="statistic" style="height:120px;">
            <p class="num center">
              122.9
            </p>
            <p class="unit center">
              最小值
            </p>
          </span>
          <span class="statistic" style="height:120px;">
            <p class="num center">
              792.5
            </p>
            <p class="unit center">
              最大值
            </p>
          </span>


      </div>

    </div>

  </div>
  <div id='content'>
      <canvas style="height: 300px;" id='chart' ></canvas>
  </div>
  <script>
      var step = 1;
      var myChart;
      var from = new Date();
      var to  = new Date(from.getTime() + 59 * 1000 * step);
      var labels = generateLabels(from, to);
      var x = [];
      var y = [];
      var z = [];

      setInterval(function(){
        $.ajax({
          url: '/api/sensor/42/value',
          context: window,
          async: true,
          dataType: 'json'
        }).done(function(data){
          var lastUpdatedTime = new Date(data.lastUpdatedTime);
          lastUpdatedTime.setMilliseconds(0);

          var seconds;
          if (lastUpdatedTime >= from && lastUpdatedTime <= to)
          {
              seconds = lastUpdatedTime.getSeconds();
              if (x[seconds] == null && y[seconds] == null && z[seconds] == null)
              {
                  x[seconds] = data.x;
                  y[seconds] = data.y;
                  z[seconds] = data.z;


                  generateLabels(from, to);
                  myChart.update();
              }
          }
          else if (lastUpdatedTime > to)
          {
              to = new Date(lastUpdatedTime.getTime());
              from = new Date(from.getTime() + 1000 * step);
              generateLabels(from, to);
              x.shift();
              x.push(data.x);

              y.shift();
              y.push(data.y);

              z.shift();
              z.push(data.z);

              myChart.update();
          }
        });
      }.bind(window), 10)

      function calculateStartTime(oDate)
      {
          oDate.setSeconds(0);
          oDate.setMilliseconds(0);
          var iTime = oDate.getTime();
          var from = new Date(iTime);
          return from;
      }


      function generateLabel(timeslot)
      {
          return timeslot.toTimeString().split(' ')[0]
      }


      function generateLabels(from, to)
      {
          var labels = [];
          for (var i = from.getTime(); i <= to.getTime();  i += 1000 * step)
          {
              var timeslot = new Date(i);
              labels.push(generateLabel(timeslot));
          }
          return labels;
      }

      function format(data, fieldName)
      {
          var collection = [];
          data.forEach(function(o){
              if (o[fieldName] === Number.MIN_SAFE_INTEGER)
              {
                  collection.push(null);
              }
              else {
                  collection.push(o[fieldName]);
              }
          });
          return collection;
      }




      $.ajax({
          url: '/api/sensor/42/data',
          dataType: 'json',
          context: window,
          async: false,
          data: {
            from: from.toJSON(),
            to: to.toJSON()
          }
      }).done(function(e) {
        var ctx = document.getElementById('chart').getContext('2d');

        x = format(e, 'x');
        y = format(e, 'y');
        z = format(e, 'z');


        myChart = new Chart(ctx, {
          type: 'line',
          data: {
              labels: labels,
              datasets: [
                 {
                     label: 'x',
                     borderColor: "#00bcd4",
                     backgroundColor: "rgba(0, 188, 212, 0.3)",
                     data: x
                 },
                 {
                     label: 'y',
                     borderColor: '#40a7ff',
                     backgroundColor: 'rgba(64, 167, 255, 0.3)',
                     data: y
                 },
                 {
                     label: 'z',
                     borderColor: 'red',
                     backgroundColor: 'red',
                     data:z
                 }
             ]
          }
        });
      });

  </script>

</section>


      </div>
    </div>
  </body>


  <!-- ================================================
  Scripts
  ================================================ -->
  <script src="js/script.js" type="text/javascript"></script>
  <!-- jQuery Library -->

  <!--materialize js-->
  <script type="text/javascript" src="js/materialize.js"></script>
  <!--scrollbar-->
  <script type="text/javascript" src="js/plugins/perfect-scrollbar/perfect-scrollbar.min.js"></script>


  <!-- chartist-->
  <script type="text/javascript" src="js/plugins/chartist-js/chartist.min.js"></script>

  <!-- chartjs -->
  <script type="text/javascript" src="js/plugins/chartjs/chart.min.js"></script>
  <script type="text/javascript" src="js/plugins/chartjs/chart-script.js"></script>

  <!-- sparkline -->
  <script type="text/javascript" src="js/plugins/sparkline/jquery.sparkline.min.js"></script>
  <script type="text/javascript" src="js/plugins/sparkline/sparkline-script.js"></script>

  <!-- google map api
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAAZnaZBXLqNBRXjd-82km_NO7GUItyKek"></script>
-->
  <!--jvectormap
  <script type="text/javascript" src="js/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
  <script type="text/javascript" src="js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
  <script type="text/javascript" src="js/plugins/jvectormap/vectormap-script.js"></script>
-->

  <!--plugins.js - Some Specific JS codes for Plugin Settings-->
  <script type="text/javascript" src="js/plugins.js"></script>
  <!--custom-script.js - Add your own theme custom JS-->
  <script type="text/javascript" src="js/custom-script.js"></script>
</html>
